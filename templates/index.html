<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro de Accidentes - Sistema de Ambulancias</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link href="{{ url_for('static', filename='estilos.css') }}" rel="stylesheet" />
</head>
<body>
  <div class="container mt-4">
    <h2>üöë Registro de Accidentes</h2>
    <form id="accidenteForm" class="mt-3">
      <div class="row mb-3">
        <div class="col">
          <label for="nombre" class="form-label">Nombre del Reportante</label>
          <input type="text" class="form-control" id="nombre" placeholder="Ej. Juan P√©rez" required />
        </div>
        <div class="col">
          <label for="telefono" class="form-label">Tel√©fono</label>
          <input type="tel" class="form-control" id="telefono" placeholder="Ej. 3123456789" required />
        </div>
      </div>

      <div class="mb-3">
        <label for="descripcion" class="form-label">Descripci√≥n del Accidente</label>
        <textarea class="form-control" id="descripcion" rows="3" placeholder="Breve descripci√≥n del accidente" required></textarea>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="latitud" class="form-label">Latitud</label>
          <input type="text" class="form-control" id="latitud" readonly />
        </div>
        <div class="col">
          <label for="longitud" class="form-label">Longitud</label>
          <input type="text" class="form-control" id="longitud" readonly />
        </div>
      </div>

      <div class="d-flex flex-column gap-2">
        <button type="button" class="btn btn-primary" onclick="obtenerUbicacion()">üìç Obtener Ubicaci√≥n</button>
        <button type="button" class="btn btn-info" onclick="buscarHospital()">üè• Buscar Hospital Cercano</button>
        <button type="submit" class="btn btn-success">‚úÖ Registrar Accidente</button>
      </div>
    </form>
    <p id="mensaje" class="mt-3 text-center text-success"></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function obtenerUbicacion() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          document.getElementById("latitud").value = position.coords.latitude;
          document.getElementById("longitud").value = position.coords.longitude;
        }, function (error) {
          alert("Error obteniendo ubicaci√≥n: " + error.message);
        });
      } else {
        alert("Geolocalizaci√≥n no soportada por este navegador.");
      }
    }

    function buscarHospital() {
      const lat = document.getElementById("latitud").value;
      const lng = document.getElementById("longitud").value;

      if (!lat || !lng) {
        alert("Primero debes obtener tu ubicaci√≥n.");
        return;
      }

      const mapsUrl = `https://www.google.com/maps/search/hospital/@${lat},${lng},15z`;
      window.open(mapsUrl, "_blank");
    }

    document.getElementById("accidenteForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const data = {
        nombre: document.getElementById("nombre").value,
        telefono: document.getElementById("telefono").value,
        descripcion: document.getElementById("descripcion").value,
        latitud: document.getElementById("latitud").value,
        longitud: document.getElementById("longitud").value,
      };

      try {
        const response = await fetch("/api/accidentes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        const result = await response.json();
        document.getElementById("mensaje").innerText = result.mensaje || result.error;
        document.getElementById("mensaje").classList.add("text-success");
      } catch (err) {
        document.getElementById("mensaje").innerText = "‚ùå Error registrando el accidente.";
        document.getElementById("mensaje").classList.add("text-danger");
      }
    });
  </script>
</body>
</html>

